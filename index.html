<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Oryx Isotopes Radiopharmaceuticals Activity Decay Calculator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="light dark" />
    <!-- Link to your external stylesheet -->
    <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
    <div id="expiredOverlay" style="
  display:none;
  position:fixed;
  inset:0;
  background:var(--bg);
  color:var(--err);
  font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
  z-index:9999;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  flex-direction:column;
  padding:20px;
">
        <a href="https://www.oryxisotopes.com" target="_blank" rel="noopener" class="logo-link">
            <img src="ORYX-LOGO-FINAL-CUT-ai.png"
                 alt="Oryx Isotopes Logo"
                 class="logo fade-in" />
        </a>
        <h1 style="font-size:2rem; color:var(--err);">‚ö†Ô∏è This batch has expired</h1>
        <p style="color:var(--muted); font-size:1.1rem; max-width:480px;">
            The product is past its expiry time.<br>
            Please discard it safely or contact the Oryx Isotopes production facility.
        </p>
    </div>

    <div class="wrap">
        <header style="text-align:center;">
            <a href="https://www.oryxisotopes.com" target="_blank" rel="noopener" class="logo-link">
                <img src="ORYX-LOGO-FINAL-CUT-ai.png"
                     alt="Oryx Isotopes Logo"
                     class="logo fade-in" />
            </a>
            <h1>Oryx Isotopes Radiopharmaceuticals Activity Decay Calculator</h1>
            <p class="lead">
                Enter isotope, calibration time, and reference activity.<br />
                The calculator updates continuously to show the current activity.
            </p>
        </header>


        <div class="grid">

            <!-- Info -->
            <section class="card info">
                <h1 id="batchLabel">Shipment / Batch Info</h1>

                <div class="column">

                    <div class="field">
                        <label>Customer</label>
                        <div id="custLabel" class="muted"></div>
                    </div>
                    <div class="field">
                        <label>Doses</label>
                        <div id="dosesLabel" class="muted"></div>
                    </div>
                    <div class="field">
                        <label>Volume (mL)</label>
                        <div id="volLabel" class="muted"></div>
                    </div>
                    <div class="field">
                        <label>Expiry Date &amp; Time</label>
                        <div id="expLabel" class="muted"></div>
                    </div>
                    <div class="field">
                        <label>Remaining Time</label>
                        <div id="remainingLabel" class="muted"></div>
                    </div>
                </div>

            </section>

            <!-- Inputs -->
            <section class="card inputs">
                <div class="row">
                    <div class="field">
                        <label for="isotope">Isotope</label>
                        <select id="isotope"></select>
                    </div>
                    <div class="field">
                        <label for="halfLife">Half-life <span class="muted">(minutes)</span></label>
                        <input id="halfLife" type="number" step="0.001" inputmode="decimal" />
                        <small class="muted">Auto-filled from isotope list. You can override it.</small>
                    </div>
                </div>

                <div class="row">
                    <div class="field">
                        <label for="activity0">Activity at Calibration (<span id="unitLabel">MBq</span>)</label>
                        <input id="activity0" type="number" min="0" step="0.001" placeholder="e.g., 12000" inputmode="decimal" readonly="readonly" />
                    </div>
                    <div class="field">
                        <label for="unit">Unit</label>
                        <select id="unit">
                            <option>MBq</option>
                            <option>mCi</option>
                        </select>
                    </div>
                </div>

                <div class="row">
                    <div class="field">
                        <label for="calTime">Calibration Date &amp; Time <span class="muted">(local)</span></label>
                        <input id="calTime" type="datetime-local" />
                    </div>
                    <div class="field">
                        <label for="nowTime">Current Time <span class="muted">(auto)</span></label>
                        <input id="nowTime" type="datetime-local" disabled />
                    </div>
                </div>

                <div class="row">
                    <div class="field">
                        <button class="btn" id="recalc">Recalculate</button>
                    </div>
                    <div class="field">
                        <button class="btn secondary" id="shareLink">Copy Shareable Link</button>
                    </div>
                </div>

                <!--  <div class="notice muted">
                    URL parameters supported: <span class="mono">iso</span>, <span class="mono">a0</span>, <span class="mono">unit</span>, <span class="mono">cal</span> (e.g., <span class="mono">?iso=F-18&a0=12000&unit=MBq&cal=2025-11-08T09:45</span>).
                    Perfect for QR codes.
                </div>  -->
            </section>




            <!-- Outputs -->
            <section class="card outputs">
                <div class="chips" id="statusChips"></div>
                <div class="column-2">
                    <div class="stat" id="activityNowBox">
                        <div class="label">Current Activity</div>
                        <div class="value" id="activityNow">‚Äî</div>
                        <div class="muted" id="activityNowAlt">‚Äî</div>
                    </div>
                    <div class="stat" id="concentrationBox">
                        <div class="label">Current Concentration</div>
                        <div class="value" id="concentrationNow">‚Äî</div>
                        <div class="muted" id="concentrationNowAlt">‚Äî</div>
                    </div>
                </div>
                <div class="row">
                    <div class="stat">
                        <div class="label">Elapsed Time</div>
                        <div class="value" id="elapsed">‚Äî</div>
                        <div class="muted" id="elapsedExact">‚Äî</div>
                    </div>
                    <div class="stat">
                        <div class="label">Decay Factor</div>
                        <div class="value" id="decayFactor">‚Äî</div>
                        <div class="muted">A = A‚ÇÄ ¬∑ e<sup>‚àíŒªt</sup>, Œª = ln(2)/T<sub>¬Ω</sub></div>
                    </div>
                </div>

                <div class="hr"></div>

                <details class="foot">
                    <summary>References</summary>
                    <ul class="ref">
                        <li>Exponential decay law and decay constant relationship explained by NIST. <a href="https://physics.nist.gov/cgi-bin/cuu/Info/half_life.html" target="_blank" rel="noopener">NIST: Half-life & decay constant</a></li>
                        <li>Half-life data (authoritative nuclear structure & decay) available via IAEA LiveChart. <a href="https://www-nds.iaea.org/relnsd/vcharthtml/VChartHTML.html" target="_blank" rel="noopener">IAEA LiveChart</a></li>
                    </ul>
                </details>
            </section>



            <!-- Plan -->
            <section class="card info" id="patientPlan">
                <h1>Patient Doses Schedule</h1>
                <div class="row">
                    <div class="field">
                        <label for="targetDose">Desired Dose</label>
                        <div style="display:flex; gap:6px;">
                            <input id="targetDose" type="number" min="0" step="0.001" placeholder="e.g., 370" inputmode="decimal" style="flex:1;">
                            <select id="doseUnit">
                                <option>mCi</option>
                                <option>MBq</option>

                            </select>
                        </div>
                        <small class="muted">Dose unit independent from vial unit.</small>

                    </div>
                    <div class="field">
                        <label>Required Volume Now</label>
                        <div class="stat">
                            <div class="value" id="requiredVolume">‚Äî</div>
                            <div class="muted" id="requiredVolumeNote">‚Äî</div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="field">
                        <label for="intervalMin">Interval between patients (minutes)</label>
                        <input id="intervalMin" type="number" min="1" step="1" value="20">
                        <small class="muted">Default 20 min; editing updates times.</small>
                    </div>


                    <div class="field">
                        <label for="planStart">Plan start time (HH:MM)</label>
                        <input id="planStart" type="time">
                        <small class="muted">Default = Calibration time</small>
                    </div>


                    <div class="field">
                        <label>&nbsp;</label>
                        <div style="display:flex;gap:8px;">
                            <button class="btn" id="seedPatients">Seed from count</button>
                            <button class="btn secondary" id="addPatient">Add patient</button>
                        </div>

                    </div>
                </div>

                <div class="hr"></div>

                <div class="field">
                    <label>Patients</label>
                    <div class="stat" style="padding:0;">
                        <table style="width:100%;border-collapse:separate;border-spacing:0 8px;padding:12px;">
                            <thead>
                                <tr class="muted">
                                    <th style="text-align:center;">üîí</th>
                                    <th style="text-align:left;">Injection time (HH:MM)</th>
                                    <th style="text-align:left;">Dose (<span id="perPatientDoseUnit">mCi</span>)</th>
                                    <th style="text-align:left;">Required volume (mL)</th>
                                </tr>
                            </thead>
                            <tbody id="patientsBody"></tbody>
                        </table>
                    </div>
                </div>
                <div class="hr"></div>

                <div class="field">
                    <label>Totals</label>
                    <div class="stat">
                        <div class="value" id="totalUsedVol">Total Used: ‚Äî</div>
                        <div class="muted" id="remainingVol">Remaining: ‚Äî</div>
                    </div>
                </div>

            </section>




        </div>

    </div>

    <script src="js/data.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/patients.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
